$(document).ready(function() {
  fetchSpotifyPlaylists()
  fetchArtistArray()
})

$('#create-playlist').click(function() {
  fetchPlaylistLocation()
})

fetchSpotifyPlaylists() {

}


function fetchPlaylistLocation() {
  var param = $('#playlist-location').val()
  var city = param.replace(/ /g, "%20")

  fetchArtistArray(city)
  // var spotify_artists = fetchSpotifyArtists(artists)
  // var top_tracks = fetchTopTracks(spotify_artists)
  // var spotify_tracks = cleanTopTracks(top_tracks)
  // var spotify_playlist = initializePlaylist(spotify_tracks)
  // var playlist = addTracks(spotify_playlist, spotify_tracks)
  // renderEvents(events)
  // renderPlaylist(playlist)
  }

function fetchSpotifyArtists(artists) {
  $.each(artists, function(index, artist) {
    $.ajax({
      type: "GET",
      url: "https://api.spotify.com/v1/search?q="+ artist +"&type=artist",
    })
  })
}

function fetchArtistArray(city) {
  var location = city
  $.ajax({ //first create spotify playlist\\})
    $.ajax({
      type: 'GET',
      crossDomain: true,
      dataType: "jsonp",
      url: 'http://api.bandsintown.com/events/search.json?location='+location+'&app_id=KONCERT',
      success: function(events) {
        $.each(events, function(index, event) {
          var artist = event.artists.shift().name
          $.ajax({
            type: 'GET',
            crossDomain: true,
            url: "https://api.spotify.com/v1/search?q=" + artist + "&type=artist",
            success: function(artist) {
              var id = artist.id
              $.ajax({
                type: 'GET',
                crossDomain: true,
                url: "https://api.spotify.com/v1/artists/"+id+"/top-tracks?country=US",
                success: function(tracks) {
                  var track = tracks.shift()
                  $.ajax({
                    type: 'POST', // add track to playlist created at line 40

                  })
                }
              })
            }
          })
        }
      )},
      error: function(xhr) {
        console.log(xhr.responseText)
      }
    })
  })
}
